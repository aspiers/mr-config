# -*- mode: sh -*-

[$HOME/.GIT/3rd-party/mr]
lib = GITHUB_NAME=kitenet-mr
checkout = 
    git_clone git@github.com:aspiers/kitenet-mr.git
remotes =
    auto_remotes
    git_add_remotes <<<"kitenet git://git.kitenet.net/mr"
fixups =
    git_email mr
    ln -sf "$MR_REPO/mr" ~/bin
    ln -sf "$MR_REPO/zsh/mrcd" ~/.zsh/functions
    ln -sf "$MR_REPO/zsh/_mr_repositories" ~/.zsh/functions

[$HOME/software/scm/stow-2.1.0]
lib =
    webcheckout () {
        f=stow-2.1.0.tar.bz2
        rm -f $f
        wget http://adamspiers.org/computing/$f
        tar jxvf $f
    }
name = stow-release
checkout = webcheckout
update =
    cd ..
    rm -rf "$MR_REPO"
    webcheckout
status = true
fixups =
    cd "$MR_REPO"
    ./configure --prefix=$HOME
    make install

[$HOME/.GIT/3rd-party/stow]
skip = lazy
checkout = git_clone git@github.com:aspiers/stow.git
# STOW_COMMAND would avoid a chicken-and-egg issue finding stow
# if we used stow to install itself, but since moving it into
# its own package, we just use make install, so this is no longer
# needed.
#lib = export STOW_COMMAND="$MR_REPO/stow"

remotes = auto_remotes && savannah_rw_remote

fixups =
    cd "$MR_REPO"
    ./configure --disable-maintainer-mode --prefix=$HOME
    make install

# META is needed early on for lib/libhooks.sh, and possibly other
# things too.
[$HOME/.GIT/adamspiers.org/META]
checkout = git_clone_my_repo META
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/shell-env]
checkout = git_clone_my_repo shell-env
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/git]
name = git-config
checkout = git_clone_my_repo git
remotes = auto_remotes
stowable = true

# This one required to stop stow folding some high-level
# directories which are safer left unfolded (in case I
# accidentally put new files in there and they unintentionally go
# in a package directory).
[$HOME/.GIT/adamspiers.org/ANTIFOLD]
checkout = git_clone_my_repo ANTIFOLD
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/shell-env.adam_spiers.pub]
checkout = git_clone_my_repo shell-env.adam_spiers.pub
skip = default_skipper || user_not_adam
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/shell-env.adam_spiers.sec]
checkout = git_clone_my_repo shell-env.adam_spiers.sec
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/ssh]
skip = default_skipper || missing_exe ssh
checkout = git_clone_my_repo ssh
remotes = auto_remotes
stowable = true

[$HOME/.GIT/adamspiers.org/ssh.adam_spiers.sec]
skip = default_skipper || missing_exe ssh
checkout = git_clone_my_repo ssh.adam_spiers.sec
remotes = auto_remotes
stowable = true
