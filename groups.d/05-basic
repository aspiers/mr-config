# -*- mode: sh -*-

[$HOME/.GIT/adamspiers.org/mr-util]
checkout = git_clone_my_repo
remotes = auto_remotes
stowable = true
lib = set_email mr@adamspiers.org

[$HOME/.GIT/adamspiers.org/screen]
name = screenrc
skip = default_skipper || ( missing_exe screen && missing_exe tmux )
checkout = git_clone_my_repo
remotes = auto_remotes
stowable = true

[$HOME/.GIT/3rd-party/git-annex]
stowable = true
lib =
    mr_init_stow_package
skip = default_skipper || missing_exe git || missing_exe cabal
checkout = git_clone git://git-annex.branchable.com/
remotes = auto_remotes
fixups =
    cabal update
    cabal install --bindir=$HOME/bin c2hs
    cabal install --only-dependencies
    # cabal clean ?
    cabal configure
    cabal build
    cabal install --bindir=$STOW_PKG_PATH/bin
    mr_restow_regardless

[$HOME/software/scm/git-annex.static]
lib = mr_set_download_url https://downloads.kitenet.net/git-annex/linux/current/git-annex-standalone-amd64.tar.gz
checkout = mr_download_checkout
fixups =
    for prog in git-annex git-annex-shell git-annex-webapp; do
        ensure_symlink_exists ~/bin/$prog "$MR_REPO/$prog"
    done

[$HOME/.GIT/adamspiers.org/gnupg]
deleted = true

[$HOME/.GIT/adamspiers.org/gnupg.sec]
skip = default_skipper || missing_exe gpg
checkout = git_clone_my_repo
remotes = auto_remotes
stowable = true

[$HOME/.GIT/3rd-party/zsh-completions]
skip = missing_exe zsh
checkout = git_clone git://github.com/zsh-users/zsh-completions.git
remotes = auto_remote
fixups =
    zcpath=~/.zsh/functions/zsh-completions
    ln -sf "$MR_REPO" "$zcpath"
    [ -d ~/.zshenv.d ] || mkdir ~/.zshenv.d
    echo 'fpath=( "$fpath[@]" "'"$zcpath"'" )' > ~/.zshenv.d/zsh-completions
    zsh -c zrec
